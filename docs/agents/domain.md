# Domain Layer Guide

대상: `src/domain/**`

## 역할

도메인 계층은 비즈니스 의미와 규칙을 표현한다.
외부 기술(HTTP, CLI, 파일, 환경변수)을 몰라야 한다.
Hexagonal 기준으로 `domain`은 가장 안쪽(inside core)이다.

## 포함 가능한 것

- 엔티티(Entity), 값 객체(Value Object)
- 도메인 정책(순수 함수)
- 도메인 전용 타입/열거형

## 포함하면 안 되는 것

- `reqwest`, `tokio::process`, 파일 I/O
- 환경변수 읽기
- 콘솔 출력
- 외부 API 응답 형식 의존

## 설계 규칙

1. 타입 이름은 의도 중심으로 명명한다.
2. 도메인 정책은 부수효과 없이 순수 함수로 작성한다.
3. 도메인 타입은 가능한 불변/명시적 상태 전이를 선호한다.
4. 도메인에서 에러를 만들 때도 기술 세부사항을 노출하지 않는다.
5. 포트 인터페이스도 도메인에 두지 않고 `application`에서 관리한다.

## prpilot 도메인 규칙 예시

- SHA 기반 마커 정책 (`final`, `claim`, `agent`)
- 교차 에이전트 프롬프트 구성 정책
- 토큰 사용량 누적 규칙

## 리뷰 체크포인트

- 이 코드가 외부 시스템 상세를 알고 있지 않은가?
- 정책 변경이 인프라 교체와 무관하게 가능한가?
